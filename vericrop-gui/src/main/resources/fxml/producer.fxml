<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.shape.Rectangle?>

<?import javafx.scene.shape.Circle?>
<ScrollPane fx:id="mainScrollPane" fitToWidth="true" style="-fx-background-color: transparent; -fx-border-color: transparent;" xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="org.vericrop.gui.ProducerController">
    <content>
        <VBox fx:id="mainContainer" spacing="20" style="-fx-background-color: linear-gradient(to bottom, #f8f9fa, #e9ecef);">
            <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>

            <!-- Header -->
            <HBox spacing="15" alignment="CENTER_LEFT">
                <HBox spacing="10" alignment="CENTER">
                    <Circle radius="25" fill="linear-gradient(to right, #2E8B57, #3CB371)"/>
                    <VBox spacing="2">
                        <Label text="VeriCrop" style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #2E8B57;"/>
                        <Label text="Farm Management Dashboard" style="-fx-font-size: 14px; -fx-text-fill: #666;"/>
                    </VBox>
                </HBox>
                <Region HBox.hgrow="ALWAYS"/>

                <!-- Navigation Buttons -->
                <HBox spacing="10" alignment="CENTER">
                    <Button fx:id="analyticsButton" text="ðŸ“Š Analytics"
                            style="-fx-background-color: #6B7280; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 8; -fx-padding: 8 12;"
                            onAction="#handleShowAnalytics"/>
                    <Button fx:id="logisticsButton" text="ðŸšš Logistics"
                            style="-fx-background-color: #F59E0B; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 8; -fx-padding: 8 12;"
                            onAction="#handleShowLogistics"/>
                    <Button fx:id="consumerButton" text="ðŸ‘¥ Consumer"
                            style="-fx-background-color: #10B981; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 8; -fx-padding: 8 12;"
                            onAction="#handleShowConsumer"/>
                </HBox>

                <Label text="ðŸŒ± Smart Farming â€¢ ðŸ”— Blockchain â€¢ ðŸ¤– AI Powered" style="-fx-text-fill: #666; -fx-font-size: 12px; -fx-font-style: italic;"/>
            </HBox>

            <!-- Dashboard KPIs - Modern Cards -->
            <HBox fx:id="kpiContainer" spacing="15" alignment="CENTER">
                <VBox spacing="8" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2); -fx-pref-width: 140;">
                    <Label text="ðŸ“¦ Total Batches" style="-fx-font-weight: bold; -fx-font-size: 12px; -fx-text-fill: #555;"/>
                    <Label fx:id="totalBatchesLabel" text="0" style="-fx-font-size: 24px; -fx-text-fill: #2E8B57; -fx-font-weight: bold; -fx-alignment: center;"/>
                    <Label text="Today" style="-fx-font-size: 10px; -fx-text-fill: #888; -fx-alignment: center;"/>
                </VBox>
                <VBox spacing="8" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2); -fx-pref-width: 140;">
                    <Label text="â­ Avg Quality" style="-fx-font-weight: bold; -fx-font-size: 12px; -fx-text-fill: #555;"/>
                    <Label fx:id="avgQualityLabel" text="0%" style="-fx-font-size: 24px; -fx-text-fill: #FFA500; -fx-font-weight: bold; -fx-alignment: center;"/>
                    <Label text="Overall" style="-fx-font-size: 10px; -fx-text-fill: #888; -fx-alignment: center;"/>
                </VBox>
                <VBox spacing="8" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2); -fx-pref-width: 140;">
                    <Label text="ðŸ‘‘ Prime %" style="-fx-font-weight: bold; -fx-font-size: 12px; -fx-text-fill: #555;"/>
                    <Label fx:id="primePercentageLabel" text="0%" style="-fx-font-size: 24px; -fx-text-fill: #2196F3; -fx-font-weight: bold; -fx-alignment: center;"/>
                    <Label text="Premium" style="-fx-font-size: 10px; -fx-text-fill: #888; -fx-alignment: center;"/>
                </VBox>
                <VBox spacing="8" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2); -fx-pref-width: 140;">
                    <Label text="âŒ Rejection Rate" style="-fx-font-weight: bold; -fx-font-size: 12px; -fx-text-fill: #555;"/>
                    <Label fx:id="rejectionRateLabel" text="0%" style="-fx-font-size: 24px; -fx-text-fill: #d32f2f; -fx-font-weight: bold; -fx-alignment: center;"/>
                    <Label text="To improve" style="-fx-font-size: 10px; -fx-text-fill: #888; -fx-alignment: center;"/>
                </VBox>
            </HBox>

            <!-- Main Content Area -->
            <HBox spacing="20" VBox.vgrow="ALWAYS">
                <!-- Left Panel - Image Upload & Batch Creation -->
                <VBox fx:id="leftPanel" spacing="15" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 15, 0, 0, 3); -fx-pref-width: 380;">
                    <Label text="ðŸŒ¾ Batch Creation" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2E8B57; -fx-padding: 0 0 10 0;"/>

                    <!-- Image Upload Section -->
                    <VBox spacing="10">
                        <Label text="ðŸ“¸ 1. Upload Food Image" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #555;"/>
                        <ImageView fx:id="imageView" fitHeight="180" fitWidth="180"
                                   style="-fx-border-color: #e0e0e0; -fx-border-width: 2; -fx-border-radius: 10; -fx-background-color: #fafafa;"
                                   preserveRatio="true"/>
                        <Button fx:id="uploadButton" text="ðŸ“ Select Image" onAction="#handleUploadImage"
                                style="-fx-background-color: linear-gradient(to right, #4CAF50, #45a049); -fx-text-fill: white; -fx-font-weight: bold; -fx-pref-width: 180; -fx-background-radius: 8; -fx-padding: 8;"/>
                        <ProgressIndicator fx:id="progressIndicator" visible="false" prefWidth="30" prefHeight="30"/>
                    </VBox>

                    <!-- Quality Results -->
                    <VBox spacing="8" style="-fx-padding: 15; -fx-background-color: #f8f9fa; -fx-background-radius: 10; -fx-border-color: #e9ecef; -fx-border-radius: 10;">
                        <Label text="ðŸ” Analysis Results" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #555;"/>
                        <Label fx:id="qualityLabel" text="Quality: --" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                        <Label fx:id="confidenceLabel" text="Category: --" style="-fx-font-size: 12px; -fx-text-fill: #666;"/>
                        <Label fx:id="hashLabel" text="Hash: --" style="-fx-font-family: 'Monaco', 'Consolas', monospace; -fx-font-size: 10px; -fx-text-fill: #888;"/>
                    </VBox>

                    <!-- Batch Details -->
                    <VBox spacing="12">
                        <Label text="ðŸ“‹ 2. Batch Details" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #555;"/>
                        <TextField fx:id="batchNameField" promptText="Batch Name*" style="-fx-background-radius: 8; -fx-pref-width: 340; -fx-padding: 8;"/>
                        <TextField fx:id="farmerField" promptText="Farmer Name" style="-fx-background-radius: 8; -fx-pref-width: 340; -fx-padding: 8;"/>
                        <TextField fx:id="productTypeField" promptText="Product Type" style="-fx-background-radius: 8; -fx-pref-width: 340; -fx-padding: 8;"/>
                        <TextField fx:id="quantityField" promptText="Quantity" style="-fx-background-radius: 8; -fx-pref-width: 340; -fx-padding: 8;"/>
                    </VBox>

                    <!-- Action Buttons -->
                    <VBox spacing="10" style="-fx-padding: 10 0 0 0;">
                        <Button fx:id="createBatchButton" text="ðŸ”„ Create Blockchain Record"
                                onAction="#handleCreateBatch" disable="true"
                                style="-fx-background-color: linear-gradient(to right, #2196F3, #1976D2); -fx-text-fill: white; -fx-font-weight: bold; -fx-pref-width: 340; -fx-background-radius: 8; -fx-padding: 10;"/>
                        <HBox spacing="10">
                            <Button text="ðŸ” Validate Chain" onAction="#handleValidateChain"
                                    style="-fx-background-color: linear-gradient(to right, #FF9800, #F57C00); -fx-text-fill: white; -fx-font-weight: bold; -fx-pref-width: 165; -fx-background-radius: 8; -fx-padding: 8;"/>
                            <Button text="ðŸ”„ Refresh" onAction="#handleRefreshDashboard"
                                    style="-fx-background-color: linear-gradient(to right, #9C27B0, #7B1FA2); -fx-text-fill: white; -fx-font-weight: bold; -fx-pref-width: 165; -fx-background-radius: 8; -fx-padding: 8;"/>
                        </HBox>
                    </VBox>
                </VBox>

                <!-- Right Panel - Charts & Blockchain -->
                <VBox fx:id="rightPanel" spacing="15" VBox.vgrow="ALWAYS">
                    <!-- Top: Charts -->
                    <HBox spacing="15" VBox.vgrow="ALWAYS">
                        <!-- Quality Distribution -->
                        <VBox spacing="8" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2); -fx-pref-width: 280;">
                            <Label text="ðŸ“Š Quality Distribution" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #555;"/>
                            <PieChart fx:id="qualityDistributionChart" prefHeight="180" legendVisible="false" labelsVisible="true"/>

                            <!-- Custom Legend -->
                            <VBox spacing="5" style="-fx-padding: 10 0 0 0;">
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Rectangle width="12" height="12" fill="#4CAF50" stroke="TRANSPARENT" arcWidth="3" arcHeight="3"/>
                                    <Label text="Prime (80-100%)" style="-fx-font-size: 11px; -fx-text-fill: #555;"/>
                                </HBox>
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Rectangle width="12" height="12" fill="#FFC107" stroke="TRANSPARENT" arcWidth="3" arcHeight="3"/>
                                    <Label text="Standard (60-79%)" style="-fx-font-size: 11px; -fx-text-fill: #555;"/>
                                </HBox>
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <Rectangle width="12" height="12" fill="#F44336" stroke="TRANSPARENT" arcWidth="3" arcHeight="3"/>
                                    <Label text="Sub-standard (0-59%)" style="-fx-font-size: 11px; -fx-text-fill: #555;"/>
                                </HBox>
                            </VBox>
                        </VBox>

                        <!-- Recent Batches -->
                        <VBox spacing="8" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);" VBox.vgrow="ALWAYS">
                            <Label text="ðŸ“‹ Recent Batches" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #555;"/>
                            <ListView fx:id="recentBatchesList" prefHeight="200" style="-fx-font-size: 11px; -fx-background-radius: 8; -fx-border-radius: 8; -fx-pref-width: 300;"/>
                            <Label text="Scroll to see more batches" style="-fx-font-size: 9px; -fx-text-fill: #888; -fx-alignment: center; -fx-padding: 5 0 0 0;"/>
                        </VBox>
                    </HBox>

                    <!-- Blockchain Display -->
                    <VBox spacing="8" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);" VBox.vgrow="ALWAYS">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="â›“ï¸ Live Blockchain" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #555;"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label text="ðŸ”’ Immutable â€¢ ðŸ“ Transparent" style="-fx-font-size: 10px; -fx-text-fill: #888; -fx-font-style: italic;"/>
                        </HBox>
                        <TextArea fx:id="blockchainArea" editable="false" wrapText="true"
                                  style="-fx-font-family: 'Monaco', 'Consolas', monospace; -fx-font-size: 10px; -fx-background-radius: 8; -fx-border-radius: 8;"
                                  VBox.vgrow="ALWAYS"/>
                        <Label text="New blocks appear here when batches are created" style="-fx-font-size: 9px; -fx-text-fill: #888; -fx-alignment: center; -fx-padding: 5 0 0 0;"/>
                    </VBox>
                </VBox>
            </HBox>

            <!-- Status Bar -->
            <HBox spacing="12" style="-fx-background-color: white; -fx-padding: 12; -fx-background-radius: 10; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.05), 5, 0, 0, 1);">
                <Label text="Status:" style="-fx-font-weight: bold; -fx-text-fill: #555;"/>
                <Label text="âœ… Ready" fx:id="statusLabel" style="-fx-text-fill: #2E8B57; -fx-font-weight: bold;"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label text="ðŸ¤– ML Service: http://localhost:8000" style="-fx-text-fill: #666; -fx-font-size: 11px;"/>
                <Label text="ðŸ”— Blockchain: Active" style="-fx-text-fill: #666; -fx-font-size: 11px;"/>
                <Label text="ðŸŒ Online" style="-fx-text-fill: #4CAF50; -fx-font-size: 11px; -fx-font-weight: bold;"/>
            </HBox>
        </VBox>
    </content>
</ScrollPane>