<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>

<VBox xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="org.vericrop.gui.ConsumerController"
      styleClass="main-container" spacing="20"
      stylesheets="@../css/styles.css">

    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- Header -->
    <HBox spacing="20" alignment="CENTER_LEFT">
        <HBox spacing="10" alignment="CENTER">
            <ImageView fitHeight="45" fitWidth="45" preserveRatio="true">
                <image>
                    <Image url="@../images/vericrop-icon.png"/>
                </image>
            </ImageView>
            <VBox spacing="2">
                <Label text="VERICROP - PRODUCT VERIFICATION" styleClass="title-label"/>
                <Label text="Consumer Portal - Verify Product Authenticity" style="-fx-text-fill: #666; -fx-font-size: 12px;"/>
            </VBox>
        </HBox>
        <Region HBox.hgrow="ALWAYS"/>

        <!-- Navigation Buttons -->
        <!-- Cross-role navigation removed for role-based access control.
             Only Scan QR, Verify, and Logout buttons are shown. Users access their role-specific pages only. -->
        <Button text="Scan QR" styleClass="primary-button" onAction="#handleScanQR"/>
        <Button text="Verify Another" styleClass="success-button" onAction="#handleVerifyAnother"/>
        <Button fx:id="logoutButton" text="ðŸšª Logout"
                style="-fx-background-color: #DC2626; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 8; -fx-padding: 8 12;"
                onAction="#handleLogout"/>
    </HBox>

    <!-- Navigation Tabs -->
    <TabPane styleClass="tab-pane">
        <tabs>
            <Tab text="Scan QR">
                <VBox spacing="20" alignment="CENTER">
                    <VBox styleClass="verification-card" spacing="15" alignment="CENTER" prefWidth="500">
                        <Label text="âœ… VERIFIED: Genuine Product" styleClass="verification-success"/>
                        <Label text="ðŸŽ Summer Apples - A2386" styleClass="subtitle-label"/>

                        <!-- QR Scanner Placeholder -->
                        <Pane style="-fx-background-color: #f1f5f9; -fx-border-radius: 8; -fx-pref-height: 200; -fx-pref-width: 200;"
                        >
                            <Label text="QR Scanner\nPlaceholder"
                                   style="-fx-text-alignment: center; -fx-text-fill: #64748b;"/>
                        </Pane>

                        <TextArea promptText="Or enter Batch ID manually..."
                                  styleClass="text-field" prefWidth="300"/>
                        <Button text="Verify Product" styleClass="success-button" onAction="#handleVerifyProduct"/>
                    </VBox>
                </VBox>
            </Tab>

            <Tab text="Enter Batch ID">
                <VBox spacing="20" alignment="CENTER">
                    <VBox styleClass="dashboard-card" spacing="15" alignment="CENTER" prefWidth="400">
                        <Label text="Manual Verification" styleClass="subtitle-label"/>
                        <TextField fx:id="batchIdField" promptText="Enter Batch ID" styleClass="text-field" prefWidth="300"/>
                        <Button text="Verify" styleClass="primary-button" onAction="#handleManualVerify" defaultButton="true"/>
                    </VBox>
                </VBox>
            </Tab>

            <Tab text="Verification History">
                <VBox spacing="15">
                    <ListView fx:id="verificationHistoryList" styleClass="modern-list" VBox.vgrow="ALWAYS"/>
                    <HBox spacing="10">
                        <Button text="Clear History" styleClass="primary-button" onAction="#handleClearHistory"/>
                        <Button text="Export History" styleClass="success-button" onAction="#handleExportHistory"/>
                    </HBox>
                </VBox>
            </Tab>
        </tabs>
    </TabPane>

    <!-- Product Journey -->
    <VBox fx:id="productJourneyCard" styleClass="dashboard-card" spacing="15">
        <Label text="ðŸ“‹ Product Journey" styleClass="subtitle-label"/>
        <VBox fx:id="journeyTimelineContainer" style="-fx-border-color: #e2e8f0; -fx-border-radius: 8; -fx-padding: 15; -fx-spacing: 12;">
            <!-- Journey timeline items will be populated dynamically -->
            <HBox spacing="15" alignment="CENTER_LEFT">
                <Label fx:id="step1Icon" text="â³" style="-fx-font-size: 16;"/>
                <VBox>
                    <Label fx:id="step1Title" text="Awaiting shipment..." style="-fx-font-weight: bold;"/>
                    <Label fx:id="step1Details" text="Start a simulation to see journey updates" style="-fx-text-fill: #64748b;"/>
                </VBox>
            </HBox>
            <HBox spacing="15" alignment="CENTER_LEFT">
                <Label fx:id="step2Icon" text="â³" style="-fx-font-size: 16;"/>
                <VBox>
                    <Label fx:id="step2Title" text="In Transit" style="-fx-font-weight: bold;"/>
                    <Label fx:id="step2Details" text="--" style="-fx-text-fill: #64748b;"/>
                </VBox>
            </HBox>
            <HBox spacing="15" alignment="CENTER_LEFT">
                <Label fx:id="step3Icon" text="â³" style="-fx-font-size: 16;"/>
                <VBox>
                    <Label fx:id="step3Title" text="Approaching Destination" style="-fx-font-weight: bold;"/>
                    <Label fx:id="step3Details" text="--" style="-fx-text-fill: #64748b;"/>
                </VBox>
            </HBox>
            <HBox spacing="15" alignment="CENTER_LEFT">
                <Label fx:id="step4Icon" text="â³" style="-fx-font-size: 16;"/>
                <VBox>
                    <Label fx:id="step4Title" text="Delivered" style="-fx-font-weight: bold;"/>
                    <Label fx:id="step4Details" text="--" style="-fx-text-fill: #64748b;"/>
                </VBox>
            </HBox>
        </VBox>
    </VBox>

    <!-- Quality Metrics -->
    <VBox fx:id="qualityMetricsCard" styleClass="dashboard-card" spacing="15">
        <Label text="ðŸŽ¯ Final Quality Score" styleClass="subtitle-label"/>
        <HBox spacing="20" alignment="CENTER">
            <VBox styleClass="metric-card" spacing="5" alignment="CENTER" prefWidth="150">
                <Label fx:id="finalQualityLabel" text="--" styleClass="metric-value" style="-fx-text-fill: #10b981; -fx-font-size: 28px;"/>
                <Label text="Final Quality" styleClass="metric-label"/>
            </VBox>
            <VBox styleClass="metric-card" spacing="5" alignment="CENTER" prefWidth="120">
                <Label fx:id="temperatureLabel" text="--" styleClass="metric-value" style="-fx-text-fill: #3b82f6;"/>
                <Label text="Avg Temperature" styleClass="metric-label"/>
            </VBox>
            <VBox styleClass="metric-card" spacing="5" alignment="CENTER" prefWidth="120">
                <Label fx:id="statusLabel" text="--" styleClass="metric-value" style="-fx-text-fill: #f59e0b;"/>
                <Label text="Status" styleClass="metric-label"/>
            </VBox>
        </HBox>
    </VBox>

    <!-- Action Buttons -->
    <HBox spacing="15" alignment="CENTER">
        <Button text="ðŸ“± Share Verification" styleClass="primary-button" onAction="#handleShareVerification"/>
        <Button text="ðŸ”„ Verify Another Product" styleClass="success-button" onAction="#handleVerifyAnother"/>
    </HBox>

</VBox>