# VeriCrop Production Environment Configuration
# 
# IMPORTANT: Copy this file to .env and fill in all values before deployment
# NEVER commit the .env file with real credentials to version control
# Use a secure secret management system (Vault, AWS Secrets Manager, etc.) in production

# ============================================================================
# Application Mode
# ============================================================================
VERICROP_MODE=prod  # prod or dev - controls validation and fail-fast behavior
VERICROP_LOAD_DEMO=false  # Must be false in production

# ============================================================================
# PostgreSQL Configuration (Main Database for Batch Metadata)
# ============================================================================
POSTGRES_USER=vericrop_prod
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE  # Use strong password generator
POSTGRES_DB=vericrop_production
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# Database Connection Pool Settings (HikariCP)
DB_POOL_SIZE=20
DB_CONNECTION_TIMEOUT=30000
DB_IDLE_TIMEOUT=600000
DB_MAX_LIFETIME=1800000

# ============================================================================
# Kafka Configuration (Event Messaging)
# ============================================================================
KAFKA_BOOTSTRAP_SERVERS=kafka:29092  # Internal Docker network
KAFKA_HOST=your-kafka-external-host.com  # External access hostname
KAFKA_PORT=9092
KAFKA_ENABLED=true

# Kafka Producer Reliability Settings
KAFKA_ACKS=all  # Ensures message durability
KAFKA_RETRIES=3
KAFKA_IDEMPOTENCE=true  # Exactly-once semantics

# Kafka Topics (using defaults, customize if needed)
KAFKA_TOPIC_BATCH_EVENTS=batch-events
KAFKA_TOPIC_QUALITY_ALERTS=quality-alerts
KAFKA_TOPIC_LOGISTICS_EVENTS=logistics-events
KAFKA_TOPIC_BLOCKCHAIN_EVENTS=blockchain-events
KAFKA_TOPIC_EVALUATION_REQUESTS=evaluation-requests
KAFKA_TOPIC_EVALUATION_RESULTS=evaluation-results

# ============================================================================
# ML Service Configuration (FastAPI Quality Prediction)
# ============================================================================
ML_SERVICE_URL=http://ml-service:8000  # Internal Docker network
ML_SERVICE_PORT=8000
ML_SERVICE_TIMEOUT=30000  # milliseconds
ML_SERVICE_RETRIES=3
ML_SERVICE_RETRY_DELAY=1000  # milliseconds

# Model Download URL (if using model fetch script)
# MODEL_DOWNLOAD_URL=https://your-secure-storage.com/models/vericrop_quality_model.onnx

# ============================================================================
# Airflow Configuration
# ============================================================================
AIRFLOW_DB_USER=airflow_prod
AIRFLOW_DB_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE  # Use strong password generator
AIRFLOW_DB_NAME=airflow_production
AIRFLOW_WEBSERVER_PORT=8082

# Airflow service endpoints
VERICROP_API_URL=http://vericrop-gui:8080

# ============================================================================
# VeriCrop GUI / API Configuration
# ============================================================================
SERVER_PORT=8080

# ============================================================================
# Ledger Configuration
# ============================================================================
LEDGER_PATH=/app/ledger  # Path inside container (mount as volume)

# ============================================================================
# Quality Evaluation Configuration
# ============================================================================
QUALITY_PASS_THRESHOLD=0.7  # Minimum quality score (0.0 to 1.0)

# ============================================================================
# Logging Configuration
# ============================================================================
LOG_LEVEL=INFO  # DEBUG, INFO, WARN, ERROR
LOG_FILE_PATH=/app/logs/vericrop-gui.log  # Mount as volume for persistence

# ============================================================================
# Spring Boot Actuator Configuration
# ============================================================================
ACTUATOR_SHOW_DETAILS=when_authorized  # always, when_authorized, never

# ============================================================================
# Version/Build Information
# ============================================================================
VERSION=1.0.0  # Update for each release

# ============================================================================
# SECURITY CHECKLIST
# ============================================================================
# 
# Before deploying to production, ensure you have:
# 
# [ ] Changed all default passwords to strong, generated passwords
# [ ] Stored secrets in a secure secret management system
# [ ] Configured TLS/SSL for external endpoints
# [ ] Set up firewall rules to restrict access
# [ ] Enabled audit logging
# [ ] Configured automated backups
# [ ] Set up monitoring and alerting
# [ ] Reviewed and updated resource limits in docker-compose.prod.yml
# [ ] Tested disaster recovery procedures
# [ ] Obtained and deployed the ONNX model (vericrop_quality_model.onnx)
# [ ] Configured log aggregation (ELK, Splunk, CloudWatch, etc.)
# [ ] Set up health check monitoring
# [ ] Implemented rate limiting and DDoS protection
# [ ] Configured proper network segmentation
# [ ] Reviewed and applied security patches to base images
# [ ] Set up SSL certificate auto-renewal (Let's Encrypt, etc.)
# 
# ============================================================================
# DEPLOYMENT INSTRUCTIONS
# ============================================================================
# 
# 1. Copy this file:
#    cp .env.production.example .env
# 
# 2. Fill in all CHANGE_ME values with secure credentials
# 
# 3. Ensure ONNX model is present:
#    ./scripts/fetch_model.sh
#    # Or manually place vericrop_quality_model.onnx in docker/ml-service/model/
# 
# 4. Build and start services:
#    docker-compose -f docker-compose.prod.yml build
#    docker-compose -f docker-compose.prod.yml up -d
# 
# 5. Verify all services are healthy:
#    docker-compose -f docker-compose.prod.yml ps
#    curl http://localhost:8080/actuator/health
#    curl http://localhost:8000/health
# 
# 6. Check logs for any errors:
#    docker-compose -f docker-compose.prod.yml logs -f
# 
# 7. Run database migrations (automatic on first startup via Flyway)
# 
# 8. Enable Airflow DAGs:
#    # Navigate to http://localhost:8082
#    # Toggle on desired DAGs
# 
# For detailed deployment instructions, see DEPLOYMENT.md
